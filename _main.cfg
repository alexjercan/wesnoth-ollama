[modification]
	id=wesnoth_ollama
	name=_"Wesnoth Ollama"
	description=_"Adds a simple ollama integration into Wesnoth"
	type=hybrid
	require_modification=no
    [event]
        name = start
        first_time_only = yes

        [lua]
            code = <<
                local prompts = wesnoth.dofile("~add-ons/wesnoth-ollama/wesnoth_ollama_prompts.lua")
                wesnoth.set_variable("ollama_battle_advisor", prompts.battle_advisor)
            >>
        [/lua]
    [/event]

    [event]
        name = start

        [set_menu_item]
            id = ollama_query
            description = _"Ask Ollama LLM"
            [show_if]
                [true]
                [/true]
            [/show_if]
            [filter_location]
            [/filter_location]
            [command]
                [message]
                    speaker = narrator
                    message = _"Enter your prompt:"
                    [text_input]
                        variable = user_text
                        text = ""
                        max_length = 256
                    [/text_input]
                [/message]

                [ollama]
                    name = llm_response
                    system_prompt = "$ollama_battle_advisor"
                    model = "llama2"
                    prompt = "$user_text|"
                [/ollama]

                [message]
                    speaker = narrator
                    message = _"$llm_response|"
                [/message]
            [/command]
        [/set_menu_item]
    [/event]
[/modification]
